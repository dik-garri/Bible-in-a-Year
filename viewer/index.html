<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ë–∏–±–ª–∏—è ‚Äî –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—Å—Ç–æ–≤</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Georgia, 'Times New Roman', serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f0;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #4a4a4a;
    }
    .input-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 12px;
    }
    .translation-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .translation-toggle button {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border: 2px solid #666;
      background: white;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .translation-toggle button.active {
      background: #4a4a4a;
      color: white;
    }
    .translation-toggle button:hover:not(.active) {
      background: #eee;
    }
    button.show-btn {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: #5c7cfa;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button.show-btn:hover {
      background: #4263eb;
    }
    .examples {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
    }
    .examples code {
      background: #eee;
      padding: 2px 6px;
      border-radius: 3px;
    }

    /* Book Picker Styles */
    .picker-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .picker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .picker-header h3 {
      margin: 0;
      color: #4a4a4a;
    }
    .picker-breadcrumb {
      font-size: 13px;
      color: #888;
    }
    .picker-breadcrumb span {
      cursor: pointer;
      color: #5c7cfa;
    }
    .picker-breadcrumb span:hover {
      text-decoration: underline;
    }
    .testament-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .testament-buttons button {
      flex: 1;
      padding: 12px;
      font-size: 15px;
      border: 2px solid #5c7cfa;
      background: white;
      color: #5c7cfa;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .testament-buttons button:hover {
      background: #5c7cfa;
      color: white;
    }
    .testament-buttons button.active {
      background: #5c7cfa;
      color: white;
    }
    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 8px;
      margin-bottom: 15px;
    }
    .books-grid button {
      padding: 10px 8px;
      font-size: 13px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      text-align: left;
    }
    .books-grid button:hover {
      background: #5c7cfa;
      color: white;
      border-color: #5c7cfa;
    }
    .chapters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
      gap: 6px;
    }
    .chapters-grid button {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ddd;
      background: #f9f9f9;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .chapters-grid button:hover {
      background: #5c7cfa;
      color: white;
      border-color: #5c7cfa;
    }
    .picker-content {
      min-height: 100px;
    }
    .back-btn {
      padding: 8px 16px;
      font-size: 13px;
      border: 1px solid #888;
      background: white;
      cursor: pointer;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .back-btn:hover {
      background: #eee;
    }

    .content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .book-section {
      margin-bottom: 30px;
    }
    .book-title {
      font-size: 1.4em;
      color: #4a4a4a;
      border-bottom: 2px solid #ddd;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }
    .chapter {
      margin-bottom: 20px;
    }
    .chapter-title {
      font-size: 1.1em;
      color: #666;
      margin-bottom: 10px;
    }
    .verse {
      margin-bottom: 8px;
      line-height: 1.6;
    }
    .verse-num {
      font-weight: bold;
      color: #888;
      font-size: 0.85em;
      margin-right: 4px;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    .error {
      color: #c92a2a;
      padding: 20px;
      background: #ffe3e3;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>üìñ –ë–∏–±–ª–∏—è</h1>

  <!-- Book Picker -->
  <div class="picker-section">
    <div class="picker-header">
      <h3>–í—ã–±–æ—Ä –∫–Ω–∏–≥–∏</h3>
      <div class="picker-breadcrumb" id="breadcrumb"></div>
    </div>
    <div class="picker-content" id="picker-content">
      <div class="testament-buttons">
        <button onclick="showTestament('ot')">–í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç</button>
        <button onclick="showTestament('nt')">–ù–æ–≤—ã–π –ó–∞–≤–µ—Ç</button>
      </div>
    </div>
  </div>

  <!-- Manual Input -->
  <div class="input-section">
    <label for="query">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:</label>
    <input type="text" id="query" placeholder="–ë—ã—Ç–∏–µ 1-3; –ú–∞—Ç—Ñ–µ—è 1">

    <div class="translation-toggle">
      <button id="btn-synod" class="active" onclick="setTranslation('synod')">–°–∏–Ω–æ–¥–∞–ª—å–Ω—ã–π</button>
      <button id="btn-nrt" onclick="setTranslation('nrt')">–ù–†–ü</button>
    </div>

    <button class="show-btn" onclick="showTexts()">–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç—ã</button>

    <div class="examples">
      –ü—Ä–∏–º–µ—Ä—ã: <code>–ë—ã—Ç–∏–µ 1-3</code> ¬∑ <code>–ë—ã—Ç–∏–µ 1:5</code> ¬∑ <code>–ë—ã—Ç–∏–µ 1:5-10</code> ¬∑ <code>–ë—ã—Ç–∏–µ 1:28-2:3</code> ¬∑ <code>–ë—ã—Ç–∏–µ 1; –ú–∞—Ç—Ñ–µ—è 1</code>
    </div>
  </div>

  <div id="content" class="content">
    <p style="color: #888; text-align: center;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É –∏ –≥–ª–∞–≤—É –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –≤—Ä—É—á–Ω—É—é</p>
  </div>

  <script>
    const bookCache = {};  // { 'synod:gn': [...chapters], 'nrt:gn': [...] }
    let currentTranslation = 'synod';

    // –ö–Ω–∏–≥–∏ –í–µ—Ç—Ö–æ–≥–æ –ó–∞–≤–µ—Ç–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞, –∫–æ–ª-–≤–æ –≥–ª–∞–≤]
    const OT_BOOKS = [
      ['–ë—ã—Ç–∏–µ', 'gn', 50], ['–ò—Å—Ö–æ–¥', 'ex', 40], ['–õ–µ–≤–∏—Ç', 'lv', 27], ['–ß–∏—Å–ª–∞', 'nm', 36],
      ['–í—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ', 'dt', 34], ['–ò–∏—Å—É—Å –ù–∞–≤–∏–Ω', 'js', 24], ['–°—É–¥—å–∏', 'jud', 21], ['–†—É—Ñ—å', 'rt', 4],
      ['1 –¶–∞—Ä—Å—Ç–≤', '1sm', 31], ['2 –¶–∞—Ä—Å—Ç–≤', '2sm', 24], ['3 –¶–∞—Ä—Å—Ç–≤', '1kgs', 22], ['4 –¶–∞—Ä—Å—Ç–≤', '2kgs', 25],
      ['1 –ü–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω', '1ch', 29], ['2 –ü–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω', '2ch', 36], ['–ï–∑–¥—Ä–∞', 'ezr', 10], ['–ù–µ–µ–º–∏—è', 'ne', 13],
      ['–ï—Å—Ñ–∏—Ä—å', 'et', 10], ['–ò–æ–≤', 'job', 42], ['–ü—Å–∞–ª—Ç–∏—Ä—å', 'ps', 150], ['–ü—Ä–∏—Ç—á–∏', 'prv', 31],
      ['–ï–∫–∫–ª–µ—Å–∏–∞—Å—Ç', 'ec', 12], ['–ü–µ—Å–Ω—è –ü–µ—Å–Ω–µ–π', 'so', 8], ['–ò—Å–∞–∏—è', 'is', 66], ['–ò–µ—Ä–µ–º–∏—è', 'jr', 52],
      ['–ü–ª–∞—á –ò–µ—Ä–µ–º–∏–∏', 'lm', 5], ['–ò–µ–∑–µ–∫–∏–∏–ª—å', 'ez', 48], ['–î–∞–Ω–∏–∏–ª', 'dn', 12], ['–û—Å–∏—è', 'ho', 14],
      ['–ò–æ–∏–ª—å', 'jl', 3], ['–ê–º–æ—Å', 'am', 9], ['–ê–≤–¥–∏–π', 'ob', 1], ['–ò–æ–Ω–∞', 'jn', 4],
      ['–ú–∏—Ö–µ–π', 'mi', 7], ['–ù–∞—É–º', 'na', 3], ['–ê–≤–≤–∞–∫—É–º', 'hk', 3], ['–°–æ—Ñ–æ–Ω–∏—è', 'zp', 3],
      ['–ê–≥–≥–µ–π', 'hg', 2], ['–ó–∞—Ö–∞—Ä–∏—è', 'zc', 14], ['–ú–∞–ª–∞—Ö–∏—è', 'ml', 4]
    ];

    // –ö–Ω–∏–≥–∏ –ù–æ–≤–æ–≥–æ –ó–∞–≤–µ—Ç–∞
    const NT_BOOKS = [
      ['–ú–∞—Ç—Ñ–µ—è', 'mt', 28], ['–ú–∞—Ä–∫–∞', 'mk', 16], ['–õ—É–∫–∏', 'lk', 24], ['–ò–æ–∞–Ω–Ω–∞', 'jo', 21],
      ['–î–µ—è–Ω–∏—è', 'act', 28], ['–†–∏–º–ª—è–Ω–∞–º', 'rm', 16], ['1 –ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º', '1co', 16], ['2 –ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º', '2co', 13],
      ['–ì–∞–ª–∞—Ç–∞–º', 'gl', 6], ['–ï—Ñ–µ—Å—è–Ω–∞–º', 'eph', 6], ['–§–∏–ª–∏–ø–ø–∏–π—Ü–∞–º', 'ph', 4], ['–ö–æ–ª–æ—Å—Å—è–Ω–∞–º', 'cl', 4],
      ['1 –§–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º', '1ts', 5], ['2 –§–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º', '2ts', 3], ['1 –¢–∏–º–æ—Ñ–µ—é', '1tm', 6], ['2 –¢–∏–º–æ—Ñ–µ—é', '2tm', 4],
      ['–¢–∏—Ç—É', 'tt', 3], ['–§–∏–ª–∏–º–æ–Ω—É', 'phm', 1], ['–ï–≤—Ä–µ—è–º', 'hb', 13], ['–ò–∞–∫–æ–≤–∞', 'jm', 5],
      ['1 –ü–µ—Ç—Ä–∞', '1pe', 5], ['2 –ü–µ—Ç—Ä–∞', '2pe', 3], ['1 –ò–æ–∞–Ω–Ω–∞', '1jo', 5], ['2 –ò–æ–∞–Ω–Ω–∞', '2jo', 1],
      ['3 –ò–æ–∞–Ω–Ω–∞', '3jo', 1], ['–ò—É–¥—ã', 'jd', 1], ['–û—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ', 're', 22]
    ];

    // –ú–∞–ø–ø–∏–Ω–≥ —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–∞ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã
    const BOOK_MAP = {
      '–±—ã—Ç–∏–µ': 'gn', '–∏—Å—Ö–æ–¥': 'ex', '–ª–µ–≤–∏—Ç': 'lv', '—á–∏—Å–ª–∞': 'nm', '–≤—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ': 'dt',
      '–∏–∏—Å—É—Å –Ω–∞–≤–∏–Ω': 'js', '–Ω–∞–≤–∏–Ω': 'js', '—Å—É–¥—å–∏': 'jud', '—Ä—É—Ñ—å': 'rt',
      '1 —Ü–∞—Ä—Å—Ç–≤': '1sm', '2 —Ü–∞—Ä—Å—Ç–≤': '2sm', '3 —Ü–∞—Ä—Å—Ç–≤': '1kgs', '4 —Ü–∞—Ä—Å—Ç–≤': '2kgs',
      '1—Ü–∞—Ä—Å—Ç–≤': '1sm', '2—Ü–∞—Ä—Å—Ç–≤': '2sm', '3—Ü–∞—Ä—Å—Ç–≤': '1kgs', '4—Ü–∞—Ä—Å—Ç–≤': '2kgs',
      '1 –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω': '1ch', '2 –ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω': '2ch',
      '1–ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω': '1ch', '2–ø–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω': '2ch',
      '–µ–∑–¥—Ä–∞': 'ezr', '–Ω–µ–µ–º–∏—è': 'ne', '–µ—Å—Ñ–∏—Ä—å': 'et', '–∏–æ–≤': 'job',
      '–ø—Å–∞–ª—Ç–∏—Ä—å': 'ps', '–ø—Å–∞–ª–æ–º': 'ps', '–ø—Ä–∏—Ç—á–∏': 'prv',
      '–µ–∫–∫–ª–µ—Å–∏–∞—Å—Ç': 'ec', '–ø–µ—Å–Ω—è –ø–µ—Å–Ω–µ–π': 'so', '–ø–µ—Å–Ω—å –ø–µ—Å–Ω–µ–π': 'so',
      '–∏—Å–∞–∏—è': 'is', '–∏–µ—Ä–µ–º–∏—è': 'jr', '–ø–ª–∞—á –∏–µ—Ä–µ–º–∏–∏': 'lm',
      '–∏–µ–∑–µ–∫–∏–∏–ª—å': 'ez', '–¥–∞–Ω–∏–∏–ª': 'dn',
      '–æ—Å–∏—è': 'ho', '–∏–æ–∏–ª—å': 'jl', '–∞–º–æ—Å': 'am', '–∞–≤–¥–∏–π': 'ob',
      '–∏–æ–Ω–∞': 'jn', '–º–∏—Ö–µ–π': 'mi', '–Ω–∞—É–º': 'na', '–∞–≤–≤–∞–∫—É–º': 'hk',
      '—Å–æ—Ñ–æ–Ω–∏—è': 'zp', '–∞–≥–≥–µ–π': 'hg', '–∑–∞—Ö–∞—Ä–∏—è': 'zc', '–º–∞–ª–∞—Ö–∏—è': 'ml',
      '–º–∞—Ç—Ñ–µ—è': 'mt', '–æ—Ç –º–∞—Ç—Ñ–µ—è': 'mt', '–º–∞—Ä–∫–∞': 'mk', '–æ—Ç –º–∞—Ä–∫–∞': 'mk',
      '–ª—É–∫–∏': 'lk', '–æ—Ç –ª—É–∫–∏': 'lk', '–∏–æ–∞–Ω–Ω–∞': 'jo', '–æ—Ç –∏–æ–∞–Ω–Ω–∞': 'jo',
      '–¥–µ—è–Ω–∏—è': 'act', '—Ä–∏–º–ª—è–Ω–∞–º': 'rm',
      '1 –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º': '1co', '2 –∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º': '2co',
      '1–∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º': '1co', '2–∫–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º': '2co',
      '–≥–∞–ª–∞—Ç–∞–º': 'gl', '–µ—Ñ–µ—Å—è–Ω–∞–º': 'eph', '—Ñ–∏–ª–∏–ø–ø–∏–π—Ü–∞–º': 'ph', '–∫–æ–ª–æ—Å—Å—è–Ω–∞–º': 'cl',
      '1 —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º': '1ts', '2 —Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º': '2ts',
      '1—Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º': '1ts', '2—Ñ–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º': '2ts',
      '1 —Ç–∏–º–æ—Ñ–µ—é': '1tm', '2 —Ç–∏–º–æ—Ñ–µ—é': '2tm',
      '1—Ç–∏–º–æ—Ñ–µ—é': '1tm', '2—Ç–∏–º–æ—Ñ–µ—é': '2tm',
      '—Ç–∏—Ç—É': 'tt', '—Ñ–∏–ª–∏–º–æ–Ω—É': 'phm', '–µ–≤—Ä–µ—è–º': 'hb', '–∏–∞–∫–æ–≤–∞': 'jm',
      '1 –ø–µ—Ç—Ä–∞': '1pe', '2 –ø–µ—Ç—Ä–∞': '2pe',
      '1–ø–µ—Ç—Ä–∞': '1pe', '2–ø–µ—Ç—Ä–∞': '2pe',
      '1 –∏–æ–∞–Ω–Ω–∞': '1jo', '2 –∏–æ–∞–Ω–Ω–∞': '2jo', '3 –∏–æ–∞–Ω–Ω–∞': '3jo',
      '1–∏–æ–∞–Ω–Ω–∞': '1jo', '2–∏–æ–∞–Ω–Ω–∞': '2jo', '3–∏–æ–∞–Ω–Ω–∞': '3jo',
      '–∏—É–¥—ã': 'jd', '–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ': 're', '–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å': 're'
    };

    // –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const BOOK_NAMES = {
      'gn': '–ë—ã—Ç–∏–µ', 'ex': '–ò—Å—Ö–æ–¥', 'lv': '–õ–µ–≤–∏—Ç', 'nm': '–ß–∏—Å–ª–∞', 'dt': '–í—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ',
      'js': '–ò–∏—Å—É—Å –ù–∞–≤–∏–Ω', 'jud': '–°—É–¥—å–∏', 'rt': '–†—É—Ñ—å', '1sm': '1 –¶–∞—Ä—Å—Ç–≤', '2sm': '2 –¶–∞—Ä—Å—Ç–≤',
      '1kgs': '3 –¶–∞—Ä—Å—Ç–≤', '2kgs': '4 –¶–∞—Ä—Å—Ç–≤', '1ch': '1 –ü–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω', '2ch': '2 –ü–∞—Ä–∞–ª–∏–ø–æ–º–µ–Ω–æ–Ω',
      'ezr': '–ï–∑–¥—Ä–∞', 'ne': '–ù–µ–µ–º–∏—è', 'et': '–ï—Å—Ñ–∏—Ä—å', 'job': '–ò–æ–≤', 'ps': '–ü—Å–∞–ª—Ç–∏—Ä—å',
      'prv': '–ü—Ä–∏—Ç—á–∏', 'ec': '–ï–∫–∫–ª–µ—Å–∏–∞—Å—Ç', 'so': '–ü–µ—Å–Ω—è –ü–µ—Å–Ω–µ–π', 'is': '–ò—Å–∞–∏—è',
      'jr': '–ò–µ—Ä–µ–º–∏—è', 'lm': '–ü–ª–∞—á –ò–µ—Ä–µ–º–∏–∏', 'ez': '–ò–µ–∑–µ–∫–∏–∏–ª—å', 'dn': '–î–∞–Ω–∏–∏–ª',
      'ho': '–û—Å–∏—è', 'jl': '–ò–æ–∏–ª—å', 'am': '–ê–º–æ—Å', 'ob': '–ê–≤–¥–∏–π', 'jn': '–ò–æ–Ω–∞',
      'mi': '–ú–∏—Ö–µ–π', 'na': '–ù–∞—É–º', 'hk': '–ê–≤–≤–∞–∫—É–º', 'zp': '–°–æ—Ñ–æ–Ω–∏—è', 'hg': '–ê–≥–≥–µ–π',
      'zc': '–ó–∞—Ö–∞—Ä–∏—è', 'ml': '–ú–∞–ª–∞—Ö–∏—è', 'mt': '–ú–∞—Ç—Ñ–µ—è', 'mk': '–ú–∞—Ä–∫–∞', 'lk': '–õ—É–∫–∏',
      'jo': '–ò–æ–∞–Ω–Ω–∞', 'act': '–î–µ—è–Ω–∏—è', 'rm': '–†–∏–º–ª—è–Ω–∞–º', '1co': '1 –ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º',
      '2co': '2 –ö–æ—Ä–∏–Ω—Ñ—è–Ω–∞–º', 'gl': '–ì–∞–ª–∞—Ç–∞–º', 'eph': '–ï—Ñ–µ—Å—è–Ω–∞–º', 'ph': '–§–∏–ª–∏–ø–ø–∏–π—Ü–∞–º',
      'cl': '–ö–æ–ª–æ—Å—Å—è–Ω–∞–º', '1ts': '1 –§–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º', '2ts': '2 –§–µ—Å—Å–∞–ª–æ–Ω–∏–∫–∏–π—Ü–∞–º',
      '1tm': '1 –¢–∏–º–æ—Ñ–µ—é', '2tm': '2 –¢–∏–º–æ—Ñ–µ—é', 'tt': '–¢–∏—Ç—É', 'phm': '–§–∏–ª–∏–º–æ–Ω—É',
      'hb': '–ï–≤—Ä–µ—è–º', 'jm': '–ò–∞–∫–æ–≤–∞', '1pe': '1 –ü–µ—Ç—Ä–∞', '2pe': '2 –ü–µ—Ç—Ä–∞',
      '1jo': '1 –ò–æ–∞–Ω–Ω–∞', '2jo': '2 –ò–æ–∞–Ω–Ω–∞', '3jo': '3 –ò–æ–∞–Ω–Ω–∞', 'jd': '–ò—É–¥—ã', 're': '–û—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ'
    };

    let currentTestament = null;
    let currentBook = null;

    function updateBreadcrumb() {
      const bc = document.getElementById('breadcrumb');
      let html = '<span onclick="resetPicker()">–í—ã–±–æ—Ä</span>';
      if (currentTestament) {
        html += ` ‚Üí <span onclick="showTestament(\'${currentTestament}\')">${currentTestament === 'ot' ? '–í–ó' : '–ù–ó'}</span>`;
      }
      if (currentBook) {
        html += ` ‚Üí ${currentBook[0]}`;
      }
      bc.innerHTML = html;
    }

    function resetPicker() {
      currentTestament = null;
      currentBook = null;
      document.getElementById('picker-content').innerHTML = `
        <div class="testament-buttons">
          <button onclick="showTestament('ot')">–í–µ—Ç—Ö–∏–π –ó–∞–≤–µ—Ç</button>
          <button onclick="showTestament('nt')">–ù–æ–≤—ã–π –ó–∞–≤–µ—Ç</button>
        </div>
      `;
      updateBreadcrumb();
    }

    function showTestament(testament) {
      currentTestament = testament;
      currentBook = null;
      const books = testament === 'ot' ? OT_BOOKS : NT_BOOKS;

      let html = '<button class="back-btn" onclick="resetPicker()">‚Üê –ù–∞–∑–∞–¥</button>';
      html += '<div class="books-grid">';
      for (const book of books) {
        html += `<button onclick="showBook('${book[0]}', '${book[1]}', ${book[2]})">${book[0]}</button>`;
      }
      html += '</div>';

      document.getElementById('picker-content').innerHTML = html;
      updateBreadcrumb();
    }

    function showBook(name, abbrev, chapters) {
      currentBook = [name, abbrev, chapters];

      let html = `<button class="back-btn" onclick="showTestament('${currentTestament}')">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–Ω–∏–≥–∞–º</button>`;
      html += '<div class="chapters-grid">';
      for (let i = 1; i <= chapters; i++) {
        html += `<button onclick="selectChapter('${name}', ${i})">${i}</button>`;
      }
      html += '</div>';

      document.getElementById('picker-content').innerHTML = html;
      updateBreadcrumb();
    }

    function selectChapter(bookName, chapter) {
      const query = `${bookName} ${chapter}`;
      document.getElementById('query').value = query;
      showTexts();
    }

    function setTranslation(t) {
      currentTranslation = t;
      document.getElementById('btn-synod').classList.toggle('active', t === 'synod');
      document.getElementById('btn-nrt').classList.toggle('active', t === 'nrt');
    }

    async function loadBook(abbrev) {
      const cacheKey = `${currentTranslation}:${abbrev}`;
      if (bookCache[cacheKey]) return bookCache[cacheKey];

      const dir = currentTranslation === 'synod' ? 'synodal' : 'nrt';
      const file = `../data/${dir}/${abbrev}.json`;

      try {
        const response = await fetch(file);
        if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        const chapters = await response.json();
        bookCache[cacheKey] = chapters;
        return chapters;
      } catch (e) {
        throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${file}: ${e.message}`);
      }
    }

    function parseQuery(query) {
      // –§–æ—Ä–º–∞—Ç—ã:
      // "–ë—ã—Ç–∏–µ 1" ‚Üí –≥–ª–∞–≤–∞ 1, –≤—Å–µ —Å—Ç–∏—Ö–∏
      // "–ë—ã—Ç–∏–µ 1-3" ‚Üí –≥–ª–∞–≤—ã 1-3, –≤—Å–µ —Å—Ç–∏—Ö–∏
      // "–ë—ã—Ç–∏–µ 1:5" ‚Üí –≥–ª–∞–≤–∞ 1, —Å—Ç–∏—Ö 5
      // "–ë—ã—Ç–∏–µ 1:5-10" ‚Üí –≥–ª–∞–≤–∞ 1, —Å—Ç–∏—Ö–∏ 5-10
      // "–ë—ã—Ç–∏–µ 1:5-2:3" ‚Üí –æ—Ç –≥–ª–∞–≤—ã 1 —Å—Ç–∏—Ö 5 –¥–æ –≥–ª–∞–≤—ã 2 —Å—Ç–∏—Ö 3
      // "–ë—ã—Ç–∏–µ 1-2:3" ‚Üí –æ—Ç –≥–ª–∞–≤—ã 1 —Å—Ç–∏—Ö 1 –¥–æ –≥–ª–∞–≤—ã 2 —Å—Ç–∏—Ö 3
      const parts = query.split(';').map(s => s.trim()).filter(s => s);
      const result = [];

      for (const part of parts) {
        const match = part.match(/^(.+?)\s+(\d+)(?::(\d+))?(?:-(\d+)(?::(\d+))?)?$/);

        if (match) {
          const bookName = match[1].trim().toLowerCase();
          const abbrev = BOOK_MAP[bookName];

          if (!abbrev) {
            console.warn('–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', bookName);
            continue;
          }

          const num1 = parseInt(match[2]);
          const num2 = match[3] ? parseInt(match[3]) : null;
          const num3 = match[4] ? parseInt(match[4]) : null;
          const num4 = match[5] ? parseInt(match[5]) : null;

          let chapterStart, chapterEnd, verseStart, verseEnd;

          if (num2 === null && num4 === null) {
            chapterStart = num1;
            chapterEnd = num3 !== null ? num3 : num1;
            verseStart = null;
            verseEnd = null;
          } else if (num2 === null && num4 !== null) {
            chapterStart = num1;
            verseStart = 1;
            chapterEnd = num3;
            verseEnd = num4;
          } else {
            chapterStart = num1;
            verseStart = num2;

            if (num4 !== null) {
              chapterEnd = num3;
              verseEnd = num4;
            } else if (num3 !== null) {
              chapterEnd = num1;
              verseEnd = num3;
            } else {
              chapterEnd = num1;
              verseEnd = num2;
            }
          }

          result.push({
            abbrev,
            chapterStart,
            chapterEnd,
            verseStart,
            verseEnd
          });
        }
      }

      return result;
    }

    function renderTexts(parsed, loadedBooks) {
      let html = '';

      for (const item of parsed) {
        const chapters = loadedBooks[item.abbrev];
        if (!chapters) {
          html += `<div class="error">–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${item.abbrev}</div>`;
          continue;
        }

        const bookName = BOOK_NAMES[item.abbrev] || item.abbrev;
        html += `<div class="book-section"><div class="book-title">${bookName}</div>`;

        for (let ch = item.chapterStart; ch <= item.chapterEnd; ch++) {
          const chapterIdx = ch - 1;
          if (chapterIdx < 0 || chapterIdx >= chapters.length) {
            html += `<div class="error">–ì–ª–∞–≤–∞ ${ch} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>`;
            continue;
          }

          const verses = chapters[chapterIdx];
          html += `<div class="chapter"><div class="chapter-title">–ì–ª–∞–≤–∞ ${ch}</div>`;

          let vStart = 1;
          let vEnd = verses.length;

          if (item.verseStart !== null) {
            if (ch === item.chapterStart && ch === item.chapterEnd) {
              vStart = item.verseStart;
              vEnd = item.verseEnd;
            } else if (ch === item.chapterStart) {
              vStart = item.verseStart;
            } else if (ch === item.chapterEnd) {
              vEnd = item.verseEnd;
            }
          }

          for (let v = vStart; v <= vEnd && v <= verses.length; v++) {
            const text = verses[v - 1];
            html += `<div class="verse"><span class="verse-num">${v}</span>${text}</div>`;
          }

          html += '</div>';
        }

        html += '</div>';
      }

      return html;
    }

    async function showTexts() {
      const query = document.getElementById('query').value.trim();
      const content = document.getElementById('content');

      if (!query) {
        content.innerHTML = '<p style="color: #888; text-align: center;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–∏–≥—É –∏ –≥–ª–∞–≤—É –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –≤—Ä—É—á–Ω—É—é</p>';
        return;
      }

      content.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';

      try {
        const parsed = parseQuery(query);

        if (parsed.length === 0) {
          content.innerHTML = '<div class="error">–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∑–∞–ø—Ä–æ—Å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.</div>';
          return;
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–Ω–∏–≥–∏
        const abbrevs = [...new Set(parsed.map(p => p.abbrev))];
        const loadedBooks = {};
        await Promise.all(abbrevs.map(async (abbrev) => {
          loadedBooks[abbrev] = await loadBook(abbrev);
        }));

        content.innerHTML = renderTexts(parsed, loadedBooks);
      } catch (e) {
        content.innerHTML = `<div class="error">${e.message}</div>`;
      }
    }

    document.getElementById('query').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') showTexts();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    (function() {
      const params = new URLSearchParams(window.location.search);
      const query = params.get('q');
      const translation = params.get('t');

      if (translation === 'nrt' || translation === 'synod') {
        setTranslation(translation);
      }

      if (query) {
        document.getElementById('query').value = query;
        showTexts();
      }
    })();
  </script>
</body>
</html>
